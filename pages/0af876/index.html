<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>字节码文件结构 | F4DE</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://image-1302577725.cos.ap-beijing.myqcloud.com/img/20210328234543.jpg">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="F4DE's blog">
    <meta name="keywords" content="sec,Java,Web安全,php,python,Java安全，Shiro,tomcat">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.159b5157.css" as="style"><link rel="preload" href="/assets/js/app.65b722b4.js" as="script"><link rel="preload" href="/assets/js/2.977200c2.js" as="script"><link rel="preload" href="/assets/js/20.b202d09b.js" as="script"><link rel="prefetch" href="/assets/js/10.4af3d843.js"><link rel="prefetch" href="/assets/js/11.b1484fde.js"><link rel="prefetch" href="/assets/js/12.a173933a.js"><link rel="prefetch" href="/assets/js/13.b251eba7.js"><link rel="prefetch" href="/assets/js/14.4da1268a.js"><link rel="prefetch" href="/assets/js/15.f0a43138.js"><link rel="prefetch" href="/assets/js/16.81740bbb.js"><link rel="prefetch" href="/assets/js/17.6793069f.js"><link rel="prefetch" href="/assets/js/18.60239342.js"><link rel="prefetch" href="/assets/js/19.9cea8bb5.js"><link rel="prefetch" href="/assets/js/21.89b9c043.js"><link rel="prefetch" href="/assets/js/22.e3c80ae4.js"><link rel="prefetch" href="/assets/js/23.87206499.js"><link rel="prefetch" href="/assets/js/24.2cdeb528.js"><link rel="prefetch" href="/assets/js/25.db23ca66.js"><link rel="prefetch" href="/assets/js/26.5c1c7799.js"><link rel="prefetch" href="/assets/js/27.814b237a.js"><link rel="prefetch" href="/assets/js/28.570e7aa5.js"><link rel="prefetch" href="/assets/js/29.3baeeaaf.js"><link rel="prefetch" href="/assets/js/3.c65c974d.js"><link rel="prefetch" href="/assets/js/30.d3281462.js"><link rel="prefetch" href="/assets/js/31.eff56ba9.js"><link rel="prefetch" href="/assets/js/32.85430c1b.js"><link rel="prefetch" href="/assets/js/4.3f1430b9.js"><link rel="prefetch" href="/assets/js/5.049b3fbc.js"><link rel="prefetch" href="/assets/js/6.556dea02.js"><link rel="prefetch" href="/assets/js/7.84c18175.js"><link rel="prefetch" href="/assets/js/8.98b9b228.js"><link rel="prefetch" href="/assets/js/9.a4ba5c98.js">
    <link rel="stylesheet" href="/assets/css/0.styles.159b5157.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://www.f4de.ink/img/EB-logo.png" alt="F4DE" class="logo"> <span class="site-name can-hide">F4DE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/sec/" class="nav-link">技术</a></div><div class="nav-item"><a href="/note/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/fe0f85/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/3a4789/" class="nav-link">友链</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://image-1302577725.cos.ap-beijing.myqcloud.com/img/20210328234543.jpg"> <div class="blogger-info"><h3>F4DE</h3> <span>Web Security</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/sec/" class="nav-link">技术</a></div><div class="nav-item"><a href="/note/" class="nav-link">笔记</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/pages/fe0f85/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/3a4789/" class="nav-link">友链</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java安全</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Tomcat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Shiro</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>字节码</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/0af876/" aria-current="page" class="active sidebar-link">字节码文件结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0af876/#magic" class="sidebar-link">Magic</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#minor-major-version" class="sidebar-link">minor/major_version</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#constant-pool-count" class="sidebar-link">constantpoolcount</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#constant-pool" class="sidebar-link">constant_pool</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#access-flags" class="sidebar-link">access_flags</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#this-class" class="sidebar-link">this_class</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#super-class" class="sidebar-link">super_class</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#interfaces-count" class="sidebar-link">interfaces_count</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#interfaces-interfaces-count" class="sidebar-link">interfaces[interfaces_count]</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#fields-count" class="sidebar-link">fields_count</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#fields-fields-count" class="sidebar-link">fields[fields_count]</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#methods-count" class="sidebar-link">methods_count</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#methods-methods-count" class="sidebar-link">methods[methods_count]</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#attributes-count" class="sidebar-link">attributes_count</a></li><li class="sidebar-sub-header"><a href="/pages/0af876/#attributes-attributes-count" class="sidebar-link">attributes[attributes_count]</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>反序列化</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/sec" title="技术-目录页" data-v-33863c7e>技术</a></li> <li data-v-33863c7e><a href="/sec/#Java安全" title="技术#Java安全" data-v-33863c7e>Java安全</a></li> <li data-v-33863c7e><a href="/sec/#字节码" title="技术#字节码" data-v-33863c7e>字节码</a></li></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="https://github.com/F4ded" target="_blank" title="作者" class="beLink" data-v-33863c7e>F4DE</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-03-04</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          字节码文件结构
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><p>一篇关于Java字节码文件结构的学习笔记。</p> <p><a href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.2" target="_blank" rel="noopener noreferrer">Chapter 4. The class File Format (oracle.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Java的字节码文件格式规定如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClassFile</span> <span class="token punctuation">{</span>
    u4             magic<span class="token punctuation">;</span>
    u2             minor_version<span class="token punctuation">;</span>
    u2             major_version<span class="token punctuation">;</span>
    u2             constant_pool_count<span class="token punctuation">;</span>
    cp_info        constant_pool<span class="token punctuation">[</span>constant_pool_count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2             access_flags<span class="token punctuation">;</span>
    u2             this_class<span class="token punctuation">;</span>
    u2             super_class<span class="token punctuation">;</span>
    u2             interfaces_count<span class="token punctuation">;</span>
    u2             interfaces<span class="token punctuation">[</span>interfaces_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2             fields_count<span class="token punctuation">;</span>
    field_info     fields<span class="token punctuation">[</span>fields_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2             methods_count<span class="token punctuation">;</span>
    method_info    methods<span class="token punctuation">[</span>methods_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
    u2             attributes_count<span class="token punctuation">;</span>
    attribute_info attributes<span class="token punctuation">[</span>attributes_count<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Class文件由<strong>无符号数</strong>和<strong>表</strong>组成：</p> <ul><li>在JVM的的规范中，u1、u2、u4分别表示1、2、4字节的无符号数</li> <li>表是由多个无符号数或者其他表作为数据项的复杂数据类型，都习惯以<code>_info</code>结尾</li></ul> <blockquote><p><img src="https://img-blog.csdnimg.cn/20190510170421396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5NjM5NDg=,size_16,color_FFFFFF,t_70" alt="img"></p></blockquote> <p>下面以这个class文件为例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">TestInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token keyword">implements</span> <span class="token class-name">TestInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TestClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="magic"><a href="#magic" class="header-anchor">#</a> Magic</h2> <p>Magic（魔数）是class文件的标识，其有固定值 <code>0xCAFEBABE</code>  ，JVM加载class文件的时候会先加载4字节的数据（ <code>u4 magic</code> ）来判断该文件是不是字节码文件。</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302203849.png" alt="image-20210302203842019"></p> <h2 id="minor-major-version"><a href="#minor-major-version" class="header-anchor">#</a> minor/major_version</h2> <p><code>minor_version</code>和<code>major_version</code>两部分组成了class文件的版本号，两者分别表示副版本号和主版本号，我们常说的Java1.8、Java11表示的就是主版本号，下表是版本号的对应关系：</p> <table><thead><tr><th>JDK版本</th> <th><strong>十进制</strong></th> <th><strong>十六进制</strong></th> <th>发布时间</th></tr></thead> <tbody><tr><td>JDK1.1</td> <td>45</td> <td>2D</td> <td>1996-05</td></tr> <tr><td>JDK1.2</td> <td>46</td> <td>2E</td> <td>1998-12</td></tr> <tr><td>JDK1.3</td> <td>47</td> <td>2F</td> <td>2000-05</td></tr> <tr><td>JDK1.4</td> <td>48</td> <td>30</td> <td>2002-02</td></tr> <tr><td>JDK1.5</td> <td>49</td> <td>31</td> <td>2004-09</td></tr> <tr><td>JDK1.6</td> <td>50</td> <td>32</td> <td>2006-12</td></tr> <tr><td>JDK1.7</td> <td>51</td> <td>33</td> <td>2011-07</td></tr> <tr><td>JDK1.8</td> <td>52</td> <td>34</td> <td>2014-03</td></tr> <tr><td>Java9</td> <td>53</td> <td>35</td> <td>2017-09</td></tr> <tr><td>Java10</td> <td>54</td> <td>36</td> <td>2018-03</td></tr> <tr><td>Java11</td> <td>55</td> <td>37</td> <td>2018-09</td></tr> <tr><td>Java12</td> <td>56</td> <td>38</td> <td>2019-03</td></tr> <tr><td>Java13</td> <td>57</td> <td>39</td> <td>2019-09</td></tr> <tr><td>Java14</td> <td>58</td> <td>3A</td> <td>2020-03</td></tr> <tr><td>Java15</td> <td>59</td> <td>3B</td> <td>2020-09</td></tr></tbody></table> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302203933.png" alt="image-20210302203933815"></p> <h2 id="constant-pool-count"><a href="#constant-pool-count" class="header-anchor">#</a> constant_pool_count</h2> <p>常量池计数器 <code>u2 constant_pool_count</code>）表示的是常量池中的数量，其值为<code>常量池中的数量 + 1</code>，<strong>需要特别注意的是<code>long</code>和<code>double</code>类型的常量池对象占两个常量位，并且常量池计数是从1开始的。</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302204056.png" alt="image-20210302204056277"></p> <p>0X0036也就是54，表示常量池中有53个元素。</p> <h2 id="constant-pool"><a href="#constant-pool" class="header-anchor">#</a> constant_pool</h2> <p>常量池（constant_pool），<code>cp_info constant_pool[constant_pool_count-1]</code>是一种表结构，<code>cp_info</code>表示的是常量池对象。</p> <p>常量池中主要存放<strong>字面量</strong>和<strong>符号引用</strong>：</p> <ul><li><strong>字面量</strong>：文本字符串、被声明为<code>final</code>的常量</li> <li><strong>符号引用</strong>：类和接口的全限定名、字段的名称和描述符、方法的名称和描述符</li></ul> <p>常量池中的每一个元素都是一个表，表的类型共有<strong>14种</strong>，它们都具有一个共同的特点：<strong>表开始的部分都是一个<code>u1</code>的标志位。</strong></p> <blockquote><p>下图为常量池中14中数据类型的总表：</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210304165259.png" alt="img"></p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210304165254.png" alt="img"></p></blockquote> <img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302211926.png" alt="image-20210302211918990" style="zoom:80%;"> <p>常量池中第一个一个常量的标志为<code>0A</code>，也就是10，表示该常量为<code>CONSTANT_Methodref_info</code>，为<strong>类中方法的符号引用</strong>，按照上表，可以读出<strong>指向方法的类描述符</strong>的索引位置为<code>0x0007</code>，<strong>指向名称及类型描述符</strong>的索引位置为<code>0x0015</code>······</p> <p>使用<strong>jclasslib</strong>插件可以快速查看常量池中的常量信息：</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302212753.png" alt="image-20210302212752980"></p> <h2 id="access-flags"><a href="#access-flags" class="header-anchor">#</a> access_flags</h2> <p>访问标志（<code>u2 access_flags</code>）用于识别一些<strong>类</strong>或者<strong>接口</strong>层次的访问信息。</p> <table><thead><tr><th>标志名</th> <th>十六进制值</th> <th>描述</th></tr></thead> <tbody><tr><td>ACC_PUBLIC</td> <td>0x0001</td> <td>声明为public</td></tr> <tr><td>ACC_FINAL</td> <td>0x0010</td> <td>声明为final</td></tr> <tr><td>ACC_SUPER</td> <td>0x0020</td> <td>废弃/仅JDK1.0.2前使用，1.0.2之后都为真</td></tr> <tr><td>ACC_INTERFACE</td> <td>0x0200</td> <td>声明为接口</td></tr> <tr><td>ACC_ABSTRACT</td> <td>0x0400</td> <td>声明为abstract</td></tr> <tr><td>ACC_SYNTHETIC</td> <td>0x1000</td> <td>声明为synthetic，表示该class文件并非由Java源代码所生成</td></tr> <tr><td>ACC_ANNOTATION</td> <td>0x2000</td> <td>标识注解类型</td></tr> <tr><td>ACC_ENUM</td> <td>0x4000</td> <td>标识枚举类型</td></tr></tbody></table> <p>对于例子<code>TestClass</code>来说，它的标志应该是<code>ACC_PUBLIC</code>和<code>ACC_SUPER</code>，所以<code>access_flags</code>的值为<code>0x0001 | 0x0020 = 0x0021</code>。</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302214110.png" alt="image-20210302214109941"></p> <h2 id="this-class"><a href="#this-class" class="header-anchor">#</a> this_class</h2> <p><code>u2 this_class</code>表示的是当前类在常量池中的索引位置（<code>CONSTANT_Class_info</code>）。</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302214614.png" alt="image-20210302214614561"></p> <h2 id="super-class"><a href="#super-class" class="header-anchor">#</a> super_class</h2> <p><code>u2 super_class</code>表示的是当前类的父类在常量池中的索引位置。</p> <h2 id="interfaces-count"><a href="#interfaces-count" class="header-anchor">#</a> interfaces_count</h2> <p><code>u2 interfaces_count</code>表示当前类实现的接口数量。</p> <h2 id="interfaces-interfaces-count"><a href="#interfaces-interfaces-count" class="header-anchor">#</a> interfaces[interfaces_count]</h2> <p><code>u2 interfaces[interfaces_count]</code>表示所有接口在常量池中的索引位置。</p> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302215302.png" alt="image-20210302215302711"></p> <h2 id="fields-count"><a href="#fields-count" class="header-anchor">#</a> fields_count</h2> <p><code>u2 fields_count</code>表示类中成员变量的数量。</p> <h2 id="fields-fields-count"><a href="#fields-fields-count" class="header-anchor">#</a> fields[fields_count]</h2> <p><code>field_info fields[fields_count]</code>是成员变量表（字段表）信息，字段表的结构如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>field_info <span class="token punctuation">{</span>
   u2 access_flags<span class="token punctuation">;</span> <span class="token comment">//成员变量访问标志</span>
   u2 name_index<span class="token punctuation">;</span> <span class="token comment">//成员变量名称在常量池中的索引</span>
   u2 descriptor_index<span class="token punctuation">;</span> <span class="token comment">//成员变量的描述符在常量池中的索引</span>
   u2 attributes_count<span class="token punctuation">;</span> <span class="token comment">//成员变量属性数量</span>
   attribute_info attributes<span class="token punctuation">[</span>attributes_count<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//成员变量的属性信息</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>成员变量访问标志表：</p> <table><thead><tr><th>权限名称</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>ACC_PUBLIC</td> <td>0x0001</td> <td>public</td></tr> <tr><td>ACC_PRIVATE</td> <td>0x0002</td> <td>private</td></tr> <tr><td>ACC_PROTECTED</td> <td>0x0004</td> <td>protected</td></tr> <tr><td>ACC_STATIC</td> <td>0x0008</td> <td>static，静态</td></tr> <tr><td>ACC_FINAL</td> <td>0x0010</td> <td>final</td></tr> <tr><td>ACC_VOLATILE</td> <td>0x0040</td> <td>volatile，不可和ACC_FIANL一起使用</td></tr> <tr><td>ACC_TRANSIENT</td> <td>0x0080</td> <td>在序列化中被忽略的字段</td></tr> <tr><td>ACC_SYNTHETIC</td> <td>0x1000</td> <td>由编译器产生，不存在于源代码中</td></tr> <tr><td>ACC_ENUM</td> <td>0x4000</td> <td>enum</td></tr></tbody></table></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302220419.png" alt="image-20210302220418964"></p> <ul><li>0x0002表示字段的访问标志为<code>ACC_PRIVATE</code></li> <li>0x0009表示变量名称在常量池中的索引位置为9</li> <li>0x000A表示变量描述符在常量池中的索引位置为10</li> <li>0x0000表示属性数量为0</li></ul> <h2 id="methods-count"><a href="#methods-count" class="header-anchor">#</a> methods_count</h2> <p><code>u2 methods_count</code>表示类的方法数量。</p> <h2 id="methods-methods-count"><a href="#methods-methods-count" class="header-anchor">#</a> methods[methods_count]</h2> <p><code>method_info methods[methods_count]</code>是方法表，结构和字段表是一样的。</p> <div class="language-java extra-class"><pre class="language-java"><code>method_info <span class="token punctuation">{</span>
   u2 access_flags<span class="token punctuation">;</span> <span class="token comment">//方法访问标志</span>
   u2 name_index<span class="token punctuation">;</span> <span class="token comment">//方法名称在常量池中的索引</span>
   u2 descriptor_index<span class="token punctuation">;</span> <span class="token comment">//方法的描述符在常量池中的索引</span>
   u2 attributes_count<span class="token punctuation">;</span> <span class="token comment">//方法属性数量</span>
   attribute_info attributes<span class="token punctuation">[</span>attributes_count<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//方法的属性信息</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>attribute_info attributes[attributes_count]</code>是一个很复杂的存储结构，存储着各种属性信息：</p> <div class="language-java extra-class"><pre class="language-java"><code>attribute_info <span class="token punctuation">{</span>
   u2 attribute_name_index<span class="token punctuation">;</span> <span class="token comment">//属性名称在常量池中的索引</span>
   u4 attribute_length<span class="token punctuation">;</span> <span class="token comment">//属性长度</span>
   u1 info<span class="token punctuation">[</span>attribute_length<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//属性信息，不同属性的结构不同</span>
<span class="token punctuation">}</span>
</code></pre></div><p>值得注意的是，方法代码逻辑是放在<code>code</code>属性中的，是以<strong>Java虚拟机指令</strong>的形式存储的。</p> <blockquote><p>code属性的结构：</p> <table><thead><tr><th>类型</th> <th>名称</th> <th>含义</th></tr></thead> <tbody><tr><td>u2</td> <td>attribute_name_index</td> <td>属性名称索引</td></tr> <tr><td>u4</td> <td>attribute_length</td> <td>属性长度</td></tr> <tr><td>u2</td> <td>max_stack</td> <td>操作数栈深度的最大值</td></tr> <tr><td>u2</td> <td>max_locals</td> <td>局部变量表所需的存储空间</td></tr> <tr><td>u4</td> <td>code_length</td> <td>字节码长度</td></tr> <tr><td>u1</td> <td>code[code_length]</td> <td>存储字节码指令的一系列字节流</td></tr> <tr><td>u2</td> <td>exception_table_length</td> <td>异常表长度</td></tr> <tr><td>exception_info</td> <td>exception_table</td> <td>异常表</td></tr> <tr><td>u2</td> <td>attributes_count</td> <td>属性长度</td></tr> <tr><td>attribute_info</td> <td>attributes[attributes_count]</td> <td>属性表</td></tr></tbody></table></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302223659.png" alt="image-20210302223659435"></p> <p>接着来分析<code>code</code>属性：</p> <ul><li>000D：code属性在常量池中的索引为13</li> <li>0000 003C：属性长度为60字节</li> <li>0002：max_stack为2</li> <li>0001：max_locals为1</li> <li>0000 000A：code_length为10，表示还有10个字节来存储指令</li> <li>2AB7 0001 2A06 B500 02B1：<strong>存储JVM指令的字节流</strong></li> <li>0000：没有异常抛出</li> <li>0002：表示<code>code</code>属性还有2个属性</li></ul> <p><code>code</code>属性中主要包含的属性为：<code>LineNumberTable</code>和<code>LocalVariableTable</code>。</p> <p><code>LineNumberTable</code>的结构如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">LineNumberTable_attribute</span> <span class="token punctuation">{</span>
    u2 attribute_name_index<span class="token punctuation">;</span>        <span class="token comment">//属性名称索引</span>
    u4 attribute_length<span class="token punctuation">;</span>            <span class="token comment">//属性长度</span>
    u2 line_number_table_length<span class="token punctuation">;</span>
    <span class="token punctuation">{</span>   u2 start_pc<span class="token punctuation">;</span>            <span class="token comment">//字节码行号</span>
        u2 line_number<span class="token punctuation">;</span>         <span class="token comment">//java源码行号</span>
    <span class="token punctuation">}</span> line_number_table<span class="token punctuation">[</span>line_number_table_length<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>000E：属性索引位置在常量池中的索引位置为14</p></li> <li><p>0000 000E：属性长度为14个字节</p></li> <li><p>0003：line_number_table_length为3</p></li> <li><p>0000 000A：前两个字节表示字节码行号，后两个字节表示对应的Java代码行号</p></li> <li><p>······</p></li></ul> <p>具体属性结构可以参考：<a href="https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.13" target="_blank" rel="noopener noreferrer">Chapter 4. The class File Format (oracle.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="attributes-count"><a href="#attributes-count" class="header-anchor">#</a> attributes_count</h2> <p><code>u2 attributes_count</code>表示当前class文件的属性表的元素个数。</p> <h2 id="attributes-attributes-count"><a href="#attributes-attributes-count" class="header-anchor">#</a> attributes[attributes_count]</h2> <blockquote><p>Java15中的属性表：</p> <table><thead><tr><th>属性名称</th> <th>章节</th></tr></thead> <tbody><tr><td>ConstantValue Attribute</td> <td>§4.7.2</td></tr> <tr><td>Code Attribute</td> <td>§4.7.3</td></tr> <tr><td>StackMapTable Attribute</td> <td>§4.7.4</td></tr> <tr><td>Exceptions Attribute</td> <td>§4.7.5</td></tr> <tr><td>InnerClasses Attribute</td> <td>§4.7.6</td></tr> <tr><td>EnclosingMethod Attribute</td> <td>§4.7.7</td></tr> <tr><td>Synthetic Attribute</td> <td>§4.7.8</td></tr> <tr><td>Signature Attribute</td> <td>§4.7.9</td></tr> <tr><td>SourceFile Attribute</td> <td>§4.7.10</td></tr> <tr><td>SourceDebugExtension Attribute</td> <td>§4.7.11</td></tr> <tr><td>LineNumberTable Attribute</td> <td>§4.7.12</td></tr> <tr><td>LocalVariableTable Attribute</td> <td>§4.7.13</td></tr> <tr><td>LocalVariableTypeTable Attribute</td> <td>§4.7.14</td></tr> <tr><td>Deprecated Attribute</td> <td>§4.7.15</td></tr> <tr><td>RuntimeVisibleAnnotations Attribute</td> <td>§4.7.16</td></tr> <tr><td>RuntimeInvisibleAnnotations Attribute</td> <td>§4.7.17</td></tr> <tr><td>RuntimeVisibleParameterAnnotations Attribute</td> <td>§4.7.18</td></tr> <tr><td>RuntimeInvisibleParameterAnnotations Attribute</td> <td>§4.7.19</td></tr> <tr><td>RuntimeVisibleTypeAnnotations Attribute</td> <td>§4.7.20</td></tr> <tr><td>RuntimeInvisibleTypeAnnotations Attribute</td> <td>§4.7.21</td></tr> <tr><td>AnnotationDefault Attribute</td> <td>§4.7.22</td></tr> <tr><td>BootstrapMethods Attribute</td> <td>§4.7.23</td></tr> <tr><td>MethodParameters Attribute</td> <td>§4.7.24</td></tr> <tr><td>Module Attribute</td> <td>§4.7.25</td></tr> <tr><td>ModulePackages Attribute</td> <td>§4.7.26</td></tr> <tr><td>ModuleMainClass Attribute</td> <td>§4.7.27</td></tr> <tr><td>NestHost Attribute</td> <td>§4.7.28</td></tr> <tr><td>NestMembers Attribute</td> <td>§4.7.29</td></tr></tbody></table></blockquote> <p>属性表是动态的，每一种属性都有自己独有的数据结构，在读取到属性名称之后还要根据属性的不同类型来解析不同属性表中的值。</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ecfe38/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">在Shiro中使用无CommonsCollections依赖的CommonsBeanUtils利用链</div></a> <a href="/pages/369a02/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">CommonsBeanUtils</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ecfe38/" class="prev">在Shiro中使用无CommonsCollections依赖的CommonsBeanUtils利用链</a></span> <span class="next"><a href="/pages/369a02/">CommonsBeanUtils</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ecfe38/"><div>在Shiro中使用无CommonsCollections依赖的CommonsBeanUtils利用链</div></a> <span>04-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/369a02/"><div>CommonsBeanUtils</div></a> <span>04-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/c962a4/"><div>基于Tomcat全局存储进行回显</div></a> <span>04-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:452584023@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/F4ded" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6725342618&amp;userid=269389449" title="来听音乐吧" target="_blank" class="iconfont icon-yinle2"></a><a href="https://f4de.ink" title="原博客" target="_blank" class="iconfont icon-bianji"></a><a href="https://f4de-bak.github.io/sitemap.xml" title="RSS订阅" target="_blank" class="iconfont icon-rss1"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2021
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.65b722b4.js" defer></script><script src="/assets/js/2.977200c2.js" defer></script><script src="/assets/js/20.b202d09b.js" defer></script>
  </body>
</html>