(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{438:function(t,_,a){"use strict";a.r(_);var v=a(14),s=Object(v.a)({},(function(){var t=this,_=t.$createElement,a=t._self._c||_;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("一篇关于Java字节码文件结构的学习笔记。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chapter 4. The class File Format (oracle.com)"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Java的字节码文件格式规定如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClassFile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    u4             magic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             minor_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             major_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             constant_pool_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    cp_info        constant_pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("constant_pool_count"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             access_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             this_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             super_class"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             interfaces_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             interfaces"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("interfaces_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             fields_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    field_info     fields"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("fields_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             methods_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    method_info    methods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("methods_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    u2             attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    attribute_info attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Class文件由"),a("strong",[t._v("无符号数")]),t._v("和"),a("strong",[t._v("表")]),t._v("组成：")]),t._v(" "),a("ul",[a("li",[t._v("在JVM的的规范中，u1、u2、u4分别表示1、2、4字节的无符号数")]),t._v(" "),a("li",[t._v("表是由多个无符号数或者其他表作为数据项的复杂数据类型，都习惯以"),a("code",[t._v("_info")]),t._v("结尾")])]),t._v(" "),a("blockquote",[a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190510170421396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA5NjM5NDg=,size_16,color_FFFFFF,t_70",alt:"img"}})])]),t._v(" "),a("p",[t._v("下面以这个class文件为例：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestInterface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestClass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestInterface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"magic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#magic"}},[t._v("#")]),t._v(" Magic")]),t._v(" "),a("p",[t._v("Magic（魔数）是class文件的标识，其有固定值 "),a("code",[t._v("0xCAFEBABE")]),t._v("  ，JVM加载class文件的时候会先加载4字节的数据（ "),a("code",[t._v("u4 magic")]),t._v(" ）来判断该文件是不是字节码文件。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302203849.png",alt:"image-20210302203842019"}})]),t._v(" "),a("h2",{attrs:{id:"minor-major-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minor-major-version"}},[t._v("#")]),t._v(" minor/major_version")]),t._v(" "),a("p",[a("code",[t._v("minor_version")]),t._v("和"),a("code",[t._v("major_version")]),t._v("两部分组成了class文件的版本号，两者分别表示副版本号和主版本号，我们常说的Java1.8、Java11表示的就是主版本号，下表是版本号的对应关系：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("JDK版本")]),t._v(" "),a("th",[a("strong",[t._v("十进制")])]),t._v(" "),a("th",[a("strong",[t._v("十六进制")])]),t._v(" "),a("th",[t._v("发布时间")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("JDK1.1")]),t._v(" "),a("td",[t._v("45")]),t._v(" "),a("td",[t._v("2D")]),t._v(" "),a("td",[t._v("1996-05")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.2")]),t._v(" "),a("td",[t._v("46")]),t._v(" "),a("td",[t._v("2E")]),t._v(" "),a("td",[t._v("1998-12")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.3")]),t._v(" "),a("td",[t._v("47")]),t._v(" "),a("td",[t._v("2F")]),t._v(" "),a("td",[t._v("2000-05")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.4")]),t._v(" "),a("td",[t._v("48")]),t._v(" "),a("td",[t._v("30")]),t._v(" "),a("td",[t._v("2002-02")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.5")]),t._v(" "),a("td",[t._v("49")]),t._v(" "),a("td",[t._v("31")]),t._v(" "),a("td",[t._v("2004-09")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.6")]),t._v(" "),a("td",[t._v("50")]),t._v(" "),a("td",[t._v("32")]),t._v(" "),a("td",[t._v("2006-12")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.7")]),t._v(" "),a("td",[t._v("51")]),t._v(" "),a("td",[t._v("33")]),t._v(" "),a("td",[t._v("2011-07")])]),t._v(" "),a("tr",[a("td",[t._v("JDK1.8")]),t._v(" "),a("td",[t._v("52")]),t._v(" "),a("td",[t._v("34")]),t._v(" "),a("td",[t._v("2014-03")])]),t._v(" "),a("tr",[a("td",[t._v("Java9")]),t._v(" "),a("td",[t._v("53")]),t._v(" "),a("td",[t._v("35")]),t._v(" "),a("td",[t._v("2017-09")])]),t._v(" "),a("tr",[a("td",[t._v("Java10")]),t._v(" "),a("td",[t._v("54")]),t._v(" "),a("td",[t._v("36")]),t._v(" "),a("td",[t._v("2018-03")])]),t._v(" "),a("tr",[a("td",[t._v("Java11")]),t._v(" "),a("td",[t._v("55")]),t._v(" "),a("td",[t._v("37")]),t._v(" "),a("td",[t._v("2018-09")])]),t._v(" "),a("tr",[a("td",[t._v("Java12")]),t._v(" "),a("td",[t._v("56")]),t._v(" "),a("td",[t._v("38")]),t._v(" "),a("td",[t._v("2019-03")])]),t._v(" "),a("tr",[a("td",[t._v("Java13")]),t._v(" "),a("td",[t._v("57")]),t._v(" "),a("td",[t._v("39")]),t._v(" "),a("td",[t._v("2019-09")])]),t._v(" "),a("tr",[a("td",[t._v("Java14")]),t._v(" "),a("td",[t._v("58")]),t._v(" "),a("td",[t._v("3A")]),t._v(" "),a("td",[t._v("2020-03")])]),t._v(" "),a("tr",[a("td",[t._v("Java15")]),t._v(" "),a("td",[t._v("59")]),t._v(" "),a("td",[t._v("3B")]),t._v(" "),a("td",[t._v("2020-09")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302203933.png",alt:"image-20210302203933815"}})]),t._v(" "),a("h2",{attrs:{id:"constant-pool-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#constant-pool-count"}},[t._v("#")]),t._v(" constant_pool_count")]),t._v(" "),a("p",[t._v("常量池计数器 "),a("code",[t._v("u2 constant_pool_count")]),t._v("）表示的是常量池中的数量，其值为"),a("code",[t._v("常量池中的数量 + 1")]),t._v("，"),a("strong",[t._v("需要特别注意的是"),a("code",[t._v("long")]),t._v("和"),a("code",[t._v("double")]),t._v("类型的常量池对象占两个常量位，并且常量池计数是从1开始的。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302204056.png",alt:"image-20210302204056277"}})]),t._v(" "),a("p",[t._v("0X0036也就是54，表示常量池中有53个元素。")]),t._v(" "),a("h2",{attrs:{id:"constant-pool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#constant-pool"}},[t._v("#")]),t._v(" constant_pool")]),t._v(" "),a("p",[t._v("常量池（constant_pool），"),a("code",[t._v("cp_info constant_pool[constant_pool_count-1]")]),t._v("是一种表结构，"),a("code",[t._v("cp_info")]),t._v("表示的是常量池对象。")]),t._v(" "),a("p",[t._v("常量池中主要存放"),a("strong",[t._v("字面量")]),t._v("和"),a("strong",[t._v("符号引用")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("字面量")]),t._v("：文本字符串、被声明为"),a("code",[t._v("final")]),t._v("的常量")]),t._v(" "),a("li",[a("strong",[t._v("符号引用")]),t._v("：类和接口的全限定名、字段的名称和描述符、方法的名称和描述符")])]),t._v(" "),a("p",[t._v("常量池中的每一个元素都是一个表，表的类型共有"),a("strong",[t._v("14种")]),t._v("，它们都具有一个共同的特点："),a("strong",[t._v("表开始的部分都是一个"),a("code",[t._v("u1")]),t._v("的标志位。")])]),t._v(" "),a("blockquote",[a("p",[t._v("下图为常量池中14中数据类型的总表：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210304165259.png",alt:"img"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210304165254.png",alt:"img"}})])]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302211926.png",alt:"image-20210302211918990"}}),t._v(" "),a("p",[t._v("常量池中第一个一个常量的标志为"),a("code",[t._v("0A")]),t._v("，也就是10，表示该常量为"),a("code",[t._v("CONSTANT_Methodref_info")]),t._v("，为"),a("strong",[t._v("类中方法的符号引用")]),t._v("，按照上表，可以读出"),a("strong",[t._v("指向方法的类描述符")]),t._v("的索引位置为"),a("code",[t._v("0x0007")]),t._v("，"),a("strong",[t._v("指向名称及类型描述符")]),t._v("的索引位置为"),a("code",[t._v("0x0015")]),t._v("······")]),t._v(" "),a("p",[t._v("使用"),a("strong",[t._v("jclasslib")]),t._v("插件可以快速查看常量池中的常量信息：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302212753.png",alt:"image-20210302212752980"}})]),t._v(" "),a("h2",{attrs:{id:"access-flags"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#access-flags"}},[t._v("#")]),t._v(" access_flags")]),t._v(" "),a("p",[t._v("访问标志（"),a("code",[t._v("u2 access_flags")]),t._v("）用于识别一些"),a("strong",[t._v("类")]),t._v("或者"),a("strong",[t._v("接口")]),t._v("层次的访问信息。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("标志名")]),t._v(" "),a("th",[t._v("十六进制值")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACC_PUBLIC")]),t._v(" "),a("td",[t._v("0x0001")]),t._v(" "),a("td",[t._v("声明为public")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_FINAL")]),t._v(" "),a("td",[t._v("0x0010")]),t._v(" "),a("td",[t._v("声明为final")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_SUPER")]),t._v(" "),a("td",[t._v("0x0020")]),t._v(" "),a("td",[t._v("废弃/仅JDK1.0.2前使用，1.0.2之后都为真")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_INTERFACE")]),t._v(" "),a("td",[t._v("0x0200")]),t._v(" "),a("td",[t._v("声明为接口")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_ABSTRACT")]),t._v(" "),a("td",[t._v("0x0400")]),t._v(" "),a("td",[t._v("声明为abstract")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_SYNTHETIC")]),t._v(" "),a("td",[t._v("0x1000")]),t._v(" "),a("td",[t._v("声明为synthetic，表示该class文件并非由Java源代码所生成")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_ANNOTATION")]),t._v(" "),a("td",[t._v("0x2000")]),t._v(" "),a("td",[t._v("标识注解类型")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_ENUM")]),t._v(" "),a("td",[t._v("0x4000")]),t._v(" "),a("td",[t._v("标识枚举类型")])])])]),t._v(" "),a("p",[t._v("对于例子"),a("code",[t._v("TestClass")]),t._v("来说，它的标志应该是"),a("code",[t._v("ACC_PUBLIC")]),t._v("和"),a("code",[t._v("ACC_SUPER")]),t._v("，所以"),a("code",[t._v("access_flags")]),t._v("的值为"),a("code",[t._v("0x0001 | 0x0020 = 0x0021")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302214110.png",alt:"image-20210302214109941"}})]),t._v(" "),a("h2",{attrs:{id:"this-class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#this-class"}},[t._v("#")]),t._v(" this_class")]),t._v(" "),a("p",[a("code",[t._v("u2 this_class")]),t._v("表示的是当前类在常量池中的索引位置（"),a("code",[t._v("CONSTANT_Class_info")]),t._v("）。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302214614.png",alt:"image-20210302214614561"}})]),t._v(" "),a("h2",{attrs:{id:"super-class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#super-class"}},[t._v("#")]),t._v(" super_class")]),t._v(" "),a("p",[a("code",[t._v("u2 super_class")]),t._v("表示的是当前类的父类在常量池中的索引位置。")]),t._v(" "),a("h2",{attrs:{id:"interfaces-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interfaces-count"}},[t._v("#")]),t._v(" interfaces_count")]),t._v(" "),a("p",[a("code",[t._v("u2 interfaces_count")]),t._v("表示当前类实现的接口数量。")]),t._v(" "),a("h2",{attrs:{id:"interfaces-interfaces-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interfaces-interfaces-count"}},[t._v("#")]),t._v(" interfaces[interfaces_count]")]),t._v(" "),a("p",[a("code",[t._v("u2 interfaces[interfaces_count]")]),t._v("表示所有接口在常量池中的索引位置。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302215302.png",alt:"image-20210302215302711"}})]),t._v(" "),a("h2",{attrs:{id:"fields-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fields-count"}},[t._v("#")]),t._v(" fields_count")]),t._v(" "),a("p",[a("code",[t._v("u2 fields_count")]),t._v("表示类中成员变量的数量。")]),t._v(" "),a("h2",{attrs:{id:"fields-fields-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fields-fields-count"}},[t._v("#")]),t._v(" fields[fields_count]")]),t._v(" "),a("p",[a("code",[t._v("field_info fields[fields_count]")]),t._v("是成员变量表（字段表）信息，字段表的结构如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("field_info "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   u2 access_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//成员变量访问标志")]),t._v("\n   u2 name_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//成员变量名称在常量池中的索引")]),t._v("\n   u2 descriptor_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//成员变量的描述符在常量池中的索引")]),t._v("\n   u2 attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//成员变量属性数量")]),t._v("\n   attribute_info attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//成员变量的属性信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("成员变量访问标志表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("权限名称")]),t._v(" "),a("th",[t._v("值")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACC_PUBLIC")]),t._v(" "),a("td",[t._v("0x0001")]),t._v(" "),a("td",[t._v("public")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_PRIVATE")]),t._v(" "),a("td",[t._v("0x0002")]),t._v(" "),a("td",[t._v("private")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_PROTECTED")]),t._v(" "),a("td",[t._v("0x0004")]),t._v(" "),a("td",[t._v("protected")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_STATIC")]),t._v(" "),a("td",[t._v("0x0008")]),t._v(" "),a("td",[t._v("static，静态")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_FINAL")]),t._v(" "),a("td",[t._v("0x0010")]),t._v(" "),a("td",[t._v("final")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_VOLATILE")]),t._v(" "),a("td",[t._v("0x0040")]),t._v(" "),a("td",[t._v("volatile，不可和ACC_FIANL一起使用")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_TRANSIENT")]),t._v(" "),a("td",[t._v("0x0080")]),t._v(" "),a("td",[t._v("在序列化中被忽略的字段")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_SYNTHETIC")]),t._v(" "),a("td",[t._v("0x1000")]),t._v(" "),a("td",[t._v("由编译器产生，不存在于源代码中")])]),t._v(" "),a("tr",[a("td",[t._v("ACC_ENUM")]),t._v(" "),a("td",[t._v("0x4000")]),t._v(" "),a("td",[t._v("enum")])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302220419.png",alt:"image-20210302220418964"}})]),t._v(" "),a("ul",[a("li",[t._v("0x0002表示字段的访问标志为"),a("code",[t._v("ACC_PRIVATE")])]),t._v(" "),a("li",[t._v("0x0009表示变量名称在常量池中的索引位置为9")]),t._v(" "),a("li",[t._v("0x000A表示变量描述符在常量池中的索引位置为10")]),t._v(" "),a("li",[t._v("0x0000表示属性数量为0")])]),t._v(" "),a("h2",{attrs:{id:"methods-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods-count"}},[t._v("#")]),t._v(" methods_count")]),t._v(" "),a("p",[a("code",[t._v("u2 methods_count")]),t._v("表示类的方法数量。")]),t._v(" "),a("h2",{attrs:{id:"methods-methods-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods-methods-count"}},[t._v("#")]),t._v(" methods[methods_count]")]),t._v(" "),a("p",[a("code",[t._v("method_info methods[methods_count]")]),t._v("是方法表，结构和字段表是一样的。")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("method_info "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   u2 access_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//方法访问标志")]),t._v("\n   u2 name_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//方法名称在常量池中的索引")]),t._v("\n   u2 descriptor_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//方法的描述符在常量池中的索引")]),t._v("\n   u2 attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//方法属性数量")]),t._v("\n   attribute_info attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("attributes_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//方法的属性信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("attribute_info attributes[attributes_count]")]),t._v("是一个很复杂的存储结构，存储着各种属性信息：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("attribute_info "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   u2 attribute_name_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性名称在常量池中的索引")]),t._v("\n   u4 attribute_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性长度")]),t._v("\n   u1 info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("attribute_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性信息，不同属性的结构不同")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("值得注意的是，方法代码逻辑是放在"),a("code",[t._v("code")]),t._v("属性中的，是以"),a("strong",[t._v("Java虚拟机指令")]),t._v("的形式存储的。")]),t._v(" "),a("blockquote",[a("p",[t._v("code属性的结构：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("u2")]),t._v(" "),a("td",[t._v("attribute_name_index")]),t._v(" "),a("td",[t._v("属性名称索引")])]),t._v(" "),a("tr",[a("td",[t._v("u4")]),t._v(" "),a("td",[t._v("attribute_length")]),t._v(" "),a("td",[t._v("属性长度")])]),t._v(" "),a("tr",[a("td",[t._v("u2")]),t._v(" "),a("td",[t._v("max_stack")]),t._v(" "),a("td",[t._v("操作数栈深度的最大值")])]),t._v(" "),a("tr",[a("td",[t._v("u2")]),t._v(" "),a("td",[t._v("max_locals")]),t._v(" "),a("td",[t._v("局部变量表所需的存储空间")])]),t._v(" "),a("tr",[a("td",[t._v("u4")]),t._v(" "),a("td",[t._v("code_length")]),t._v(" "),a("td",[t._v("字节码长度")])]),t._v(" "),a("tr",[a("td",[t._v("u1")]),t._v(" "),a("td",[t._v("code[code_length]")]),t._v(" "),a("td",[t._v("存储字节码指令的一系列字节流")])]),t._v(" "),a("tr",[a("td",[t._v("u2")]),t._v(" "),a("td",[t._v("exception_table_length")]),t._v(" "),a("td",[t._v("异常表长度")])]),t._v(" "),a("tr",[a("td",[t._v("exception_info")]),t._v(" "),a("td",[t._v("exception_table")]),t._v(" "),a("td",[t._v("异常表")])]),t._v(" "),a("tr",[a("td",[t._v("u2")]),t._v(" "),a("td",[t._v("attributes_count")]),t._v(" "),a("td",[t._v("属性长度")])]),t._v(" "),a("tr",[a("td",[t._v("attribute_info")]),t._v(" "),a("td",[t._v("attributes[attributes_count]")]),t._v(" "),a("td",[t._v("属性表")])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/f4de-bak/picture/picture20210302223659.png",alt:"image-20210302223659435"}})]),t._v(" "),a("p",[t._v("接着来分析"),a("code",[t._v("code")]),t._v("属性：")]),t._v(" "),a("ul",[a("li",[t._v("000D：code属性在常量池中的索引为13")]),t._v(" "),a("li",[t._v("0000 003C：属性长度为60字节")]),t._v(" "),a("li",[t._v("0002：max_stack为2")]),t._v(" "),a("li",[t._v("0001：max_locals为1")]),t._v(" "),a("li",[t._v("0000 000A：code_length为10，表示还有10个字节来存储指令")]),t._v(" "),a("li",[t._v("2AB7 0001 2A06 B500 02B1："),a("strong",[t._v("存储JVM指令的字节流")])]),t._v(" "),a("li",[t._v("0000：没有异常抛出")]),t._v(" "),a("li",[t._v("0002：表示"),a("code",[t._v("code")]),t._v("属性还有2个属性")])]),t._v(" "),a("p",[a("code",[t._v("code")]),t._v("属性中主要包含的属性为："),a("code",[t._v("LineNumberTable")]),t._v("和"),a("code",[t._v("LocalVariableTable")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("LineNumberTable")]),t._v("的结构如下：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LineNumberTable_attribute")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    u2 attribute_name_index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性名称索引")]),t._v("\n    u4 attribute_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//属性长度")]),t._v("\n    u2 line_number_table_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   u2 start_pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//字节码行号")]),t._v("\n        u2 line_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//java源码行号")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" line_number_table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("line_number_table_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("000E：属性索引位置在常量池中的索引位置为14")])]),t._v(" "),a("li",[a("p",[t._v("0000 000E：属性长度为14个字节")])]),t._v(" "),a("li",[a("p",[t._v("0003：line_number_table_length为3")])]),t._v(" "),a("li",[a("p",[t._v("0000 000A：前两个字节表示字节码行号，后两个字节表示对应的Java代码行号")])]),t._v(" "),a("li",[a("p",[t._v("······")])])]),t._v(" "),a("p",[t._v("具体属性结构可以参考："),a("a",{attrs:{href:"https://docs.oracle.com/javase/specs/jvms/se15/html/jvms-4.html#jvms-4.7.13",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chapter 4. The class File Format (oracle.com)"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"attributes-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attributes-count"}},[t._v("#")]),t._v(" attributes_count")]),t._v(" "),a("p",[a("code",[t._v("u2 attributes_count")]),t._v("表示当前class文件的属性表的元素个数。")]),t._v(" "),a("h2",{attrs:{id:"attributes-attributes-count"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attributes-attributes-count"}},[t._v("#")]),t._v(" attributes[attributes_count]")]),t._v(" "),a("blockquote",[a("p",[t._v("Java15中的属性表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性名称")]),t._v(" "),a("th",[t._v("章节")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ConstantValue Attribute")]),t._v(" "),a("td",[t._v("§4.7.2")])]),t._v(" "),a("tr",[a("td",[t._v("Code Attribute")]),t._v(" "),a("td",[t._v("§4.7.3")])]),t._v(" "),a("tr",[a("td",[t._v("StackMapTable Attribute")]),t._v(" "),a("td",[t._v("§4.7.4")])]),t._v(" "),a("tr",[a("td",[t._v("Exceptions Attribute")]),t._v(" "),a("td",[t._v("§4.7.5")])]),t._v(" "),a("tr",[a("td",[t._v("InnerClasses Attribute")]),t._v(" "),a("td",[t._v("§4.7.6")])]),t._v(" "),a("tr",[a("td",[t._v("EnclosingMethod Attribute")]),t._v(" "),a("td",[t._v("§4.7.7")])]),t._v(" "),a("tr",[a("td",[t._v("Synthetic Attribute")]),t._v(" "),a("td",[t._v("§4.7.8")])]),t._v(" "),a("tr",[a("td",[t._v("Signature Attribute")]),t._v(" "),a("td",[t._v("§4.7.9")])]),t._v(" "),a("tr",[a("td",[t._v("SourceFile Attribute")]),t._v(" "),a("td",[t._v("§4.7.10")])]),t._v(" "),a("tr",[a("td",[t._v("SourceDebugExtension Attribute")]),t._v(" "),a("td",[t._v("§4.7.11")])]),t._v(" "),a("tr",[a("td",[t._v("LineNumberTable Attribute")]),t._v(" "),a("td",[t._v("§4.7.12")])]),t._v(" "),a("tr",[a("td",[t._v("LocalVariableTable Attribute")]),t._v(" "),a("td",[t._v("§4.7.13")])]),t._v(" "),a("tr",[a("td",[t._v("LocalVariableTypeTable Attribute")]),t._v(" "),a("td",[t._v("§4.7.14")])]),t._v(" "),a("tr",[a("td",[t._v("Deprecated Attribute")]),t._v(" "),a("td",[t._v("§4.7.15")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeVisibleAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.16")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeInvisibleAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.17")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeVisibleParameterAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.18")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeInvisibleParameterAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.19")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeVisibleTypeAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.20")])]),t._v(" "),a("tr",[a("td",[t._v("RuntimeInvisibleTypeAnnotations Attribute")]),t._v(" "),a("td",[t._v("§4.7.21")])]),t._v(" "),a("tr",[a("td",[t._v("AnnotationDefault Attribute")]),t._v(" "),a("td",[t._v("§4.7.22")])]),t._v(" "),a("tr",[a("td",[t._v("BootstrapMethods Attribute")]),t._v(" "),a("td",[t._v("§4.7.23")])]),t._v(" "),a("tr",[a("td",[t._v("MethodParameters Attribute")]),t._v(" "),a("td",[t._v("§4.7.24")])]),t._v(" "),a("tr",[a("td",[t._v("Module Attribute")]),t._v(" "),a("td",[t._v("§4.7.25")])]),t._v(" "),a("tr",[a("td",[t._v("ModulePackages Attribute")]),t._v(" "),a("td",[t._v("§4.7.26")])]),t._v(" "),a("tr",[a("td",[t._v("ModuleMainClass Attribute")]),t._v(" "),a("td",[t._v("§4.7.27")])]),t._v(" "),a("tr",[a("td",[t._v("NestHost Attribute")]),t._v(" "),a("td",[t._v("§4.7.28")])]),t._v(" "),a("tr",[a("td",[t._v("NestMembers Attribute")]),t._v(" "),a("td",[t._v("§4.7.29")])])])])]),t._v(" "),a("p",[t._v("属性表是动态的，每一种属性都有自己独有的数据结构，在读取到属性名称之后还要根据属性的不同类型来解析不同属性表中的值。")])])}),[],!1,null,null,null);_.default=s.exports}}]);